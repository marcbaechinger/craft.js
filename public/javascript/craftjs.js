var controller=controller||{version:"0.0.1"};(function(e,t){var n="@",r=!1,i="body",s={actionAwareEvents:"click",modelValueDataAttribute:"model-val"},o=function(e){return t.extend(this,s,e),this};o.prototype.init=function(){return this.containerSelector=this.containerSelector||i,this.container||(this.container=t(this.containerSelector)),delete this.containerSelector,this.resolveUIElements(),this.attachEvents(),this.bindActionHandler(),console.log("controller started: ",this.container.attr("id")),this},o.prototype.bindActionHandler=function(){var e=this;r&&console.log("bind action handler to '"+this.actionAwareEvents+"'"),this.container.bind(this.actionAwareEvents,function(n){var i=t(n.target).closest("[data-action]"),s=i.data("action");n.type[0]==="@"&&(r&&console.log("caught and reroute action event "+n.type,n.target,arguments[1],e),s=n.type.substring(1)),typeof e.actions[s]=="function"&&(e.actions[s].apply(e,arguments),n.preventDefault(),n.stopPropagation())})},o.prototype.attachEvents=function(){var e,t,i,s,o=" ",u=this;this.actions=this.actions||[];for(e in this.events)this.events.hasOwnProperty(e)&&(t=e.split(" "),i=t.shift(),s=t.join(" "),i[0]===n?(r&&console.log("attachEvents("+e+") -> register action handler "+"controller('"+this.container+"').events['"+e+"'] for action '"+i+"'"),this.actions[i.substring(1)]=this.events[e],o.indexOf(i+" ")===-1&&(o+=i+" ")):(r&&console.log("attachEvents("+e+") -> delegate '"+i+"' of elements matching '"+s+"' to controller('"+this.container+"').events['"+e+"']"),this.container.delegate(s,i,this.createDelegator(e))));this.actionAwareEvents+=o,r&&console.log("events to be bound to after attaching actions: '"+this.actionAwareEvents+"'")},o.prototype.createDelegator=function(e){var t=this;return function(n){t.events[e].call(t,n)}},o.prototype.resolveUIElements=function(){var e,t;this.$elements=this.$elements||{},this.scann===!0&&this.scannForElements();if(this.elementSelectors)for(e in this.elementSelectors)this.elementSelectors.hasOwnProperty(e)&&(t=this.elementSelectors[e],r&&console.log("resolveUIElement("+e+"-"+t+") -> attach element with selector '"+t+"' to this.$elements."+e),this.$elements[e]=this.container.find(t))},o.prototype.scannForElements=function(){var e=this.$elements,n=this;this.container.find("[data-"+this.modelValueDataAttribute+"]").each(function(){var i=t(this);r&&console.log("Controller.scannForElements(): found element with att 'data-"+n.modelValueDataAttribute+"'"),e[i.data(n.modelValueDataAttribute)]=i})},e.Controller=o,e.renderer={}})(controller,$);var model=model||{version:"1.0"};(function(e){var t=function(){return this.observerMap={},this};t.prototype.unbind=function(e,t){var n=this.observerMap[e],r;if(n)for(r=0;r<n.length;r+=1)if(n[r]===t){n.splice(r,1);break}return this},t.prototype.bind=function(e,t){return this.observerMap[e]||(this.observerMap[e]=[]),this.observerMap[e].unshift(t),this},t.prototype.emit=function(e){var t,n=Array.prototype.slice.call(arguments,1);if(this.observerMap[e])for(t=0;t<this.observerMap[e].length;t+=1)this.observerMap[e][t].apply(this,n);return this},e.Observable=t})(model),function(e){var t=Object.prototype.toString,n=t.call([]),r=function(e){return t.call(e)===n},i="id",s=function(e){model.Observable.call(this),this.init(e)},o=function(e){model.Observable.call(this),this.init(e)};o.prototype=new model.Observable,o.prototype.init=function(e){this.data=this.convertArraysFieldsToCollection(e.data||{}),this.id=e.data[i]},o.prototype.convertArraysFieldsToCollection=function(e){var t;for(t in e)e.hasOwnProperty(t)&&r(e[t])&&(e[t].length<1||typeof e[t][0]=="object")&&(e[t]=new model.Collection({data:e[t]}));return e},o.prototype.get=function(e){var t;return typeof e!="undefined"?this.data[e]:this.data},o.prototype.set=function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=e[t],r(n)&&typeof n[0]=="object"?this.data[t]=new s({data:n}):t!==i&&(this.data[t]=n));this.emit("change",this)},o.prototype.delete=function(e){var t;for(t in e)e.hasOwnProperty(t)&&(t!==i?(e[t]=this.data[t],delete this.data[t]):t===i&&delete e[t]);this.emit("remove",this)},o.prototype.toString=function(){var e=this.data.label||this.data.name||this.data.title||"model: "+this.id;return e},s.prototype=new model.Observable,s.prototype.init=function(e){this.onChange=function(e){return function(t){var n;for(n=0;n<e.data.length;n++)if(t.id===e.data[n].id){e.emit("change",t,n);break}}}(this),this.data=[],e.data&&this.add(e.data)},s.prototype.addSingle=function(e,t){var n=this,r=new o({data:e});return r.bind("change",this.onChange),this.data.push(r),t||this.emit("add",r,this.data.length-1),r},s.prototype.selectByPosition=function(e,t){e>-1&&e<this.data.length?(this.selectedPosition=e,this.selectedModel=this.data[e]):e>-1?(this.selectedPosition=this.data.length-1,this.selectedModel=this.data[this.data.length-1]):e<=0&&(this.selectedPosition=-1,delete this.selectedModel),t||this.emit("selection",this.selectedModel,this.selectedPosition)},s.prototype.selectById=function(e,t){var n=this.getPositionById(e);n>-1&&this.selectByPosition(n,t)},s.prototype.getSelectedModel=function(){return this.selectedModel},s.prototype.getSelectedPosition=function(){return this.selectedPosition},s.prototype.add=function(e,t){var n,i=[];if(r(e)){for(n=0;n<e.length;n++)i.push(this.addSingle(e[n],!0));return t||this.emit("add",i),i}return this.addSingle(e,t)},s.prototype.removeSingle=function(e,t){var n,r;for(n=0;n<this.data.length;n++)if(e.id===this.data[n].id)return r=this.data[n],this.data.splice(n,1),this.selectedPosition===n?(delete this.selectedPosition,delete this.selectedModel):this.selectedPosition>n&&(this.selectedPosition-=1),r.unbind("change",this.onChange),t||this.emit("remove",r,n),r;return undefined},s.prototype.removeByPosition=function(e,t){var n;return e>-1&&e<this.data.length&&(n=this.removeSingle(this.data[e],t)),n},s.prototype.remove=function(e,t){var n,i=[];if(r(e)){for(n=e.length-1;n>=0;n--)i.unshift(this.removeSingle(e[n],!0));return t||this.emit("remove",i),i}return this.removeSingle(e,t)},s.prototype.empty=function(){return this.data.length<1},s.prototype.byId=function(e){var t;for(t=0;t<this.data.length;t++)if(e===this.data[t].id)return this.data[t];return undefined},s.prototype.getPositionById=function(e){var t;for(t=0;t<this.data.length;t++)if(e===this.data[t].id)return t;return-1},s.prototype.byPosition=function(e){return this.data[e]},s.prototype.toString=function(){var e="[",t,n=this.data.length-1;for(t=n;t>=0;t--)e+="'"+this.data[n-t].toString()+"'",t&&(e+=",");return e+"]"},e.Model=o,e.Collection=s}(model),function(e,t){var n=!1,r=Object.prototype.toString.call([]),i={isArray:function(e){return Object.prototype.toString.call(e)===r},bindThis:function(e,t){return function(){t.apply(e,arguments)}}},s={collectionItemTagName:"li",collectionItemIdAttName:"data-ui-id",onModelRemove:function(e,t){t>-1&&i.isArray(this.model.data)?this.container.find("["+this.collectionItemIdAttName+"="+e.data.id+"]").remove():this.render()},onModelAdd:function(e,t){t>-1&&i.isArray(this.model.data)?this.container.append(this.renderItem(e)):this.render()},onModelChange:function(e,t){t>-1&&i.isArray(this.model.data)?this.container.find("["+this.collectionItemIdAttName+"="+e.id+"]").replaceWith(this.renderItem(e)):this.render()},onSelectionChange:function(e,t){}},o=function(e){return controller.Controller.call(this,e),this.boundOnChange=i.bindThis(this,function(e,t){typeof this.onModelChange=="function"&&this.onModelChange(e,t),this.container.trigger("@model-change",{model:e,pos:t})}),this.boundOnRemove=i.bindThis(this,function(e,t){typeof this.onModelRemove=="function"&&this.onModelRemove(e,t),this.container.trigger("@model-remove",{model:e,pos:t})}),this.boundOnAdd=i.bindThis(this,function(e,t){typeof this.onModelAdd=="function"&&this.onModelAdd(e,t),this.container.trigger("@model-add",{model:e,pos:t})}),this.boundOnSelection=i.bindThis(this,function(e,t){typeof this.onSelectionChange=="function"&&this.onSelectionChange(e,t),this.container.trigger("@selection",{model:e,pos:t})}),this};o.prototype=new controller.Controller(s),o.prototype.init=function(){return controller.Controller.prototype.init.apply(this,arguments),this.renderTargetSelector?this.renderTarget=this.container.find(this.renderTargetSelector):this.renderTarget=this.container,this.compositeControllers={},this.setModel(this.model),this},o.prototype.setModel=function(e){this.model&&this.detachFromModel(this.model),this.model=e,typeof this.model!="undefined"&&(this.attachToModel(e),this.render()),this.container.trigger("@model-set",this.model)},o.prototype.attachToModel=function(e){i.isArray(e.data)?(e.bind("remove",this.boundOnRemove),e.bind("add",this.boundOnAdd),e.bind("change",this.boundOnChange),e.bind("selection",this.boundOnSelection)):(e.bind("change",this.boundOnChange),e.bind("remove",this.boundOnRemove))},o.prototype.detachFromModel=function(e){i.isArray(e.data)?(e.unbind("remove",this.boundOnRemove),e.unbind("add",this.boundOnAdd),e.unbind("change",this.boundOnChange),e.unbind("selection",this.boundOnSelection)):(e.unbind("change",this.boundOnChange),e.unbind("remove",this.boundOnRemove))},o.prototype.render=function(){var e=this,n="",r=0;i.isArray(this.model.data)?(t(this.model.data).each(function(){n+=e.renderItem(this,r++)}),this.renderTarget.html(n)):this.mapDataToUI(this.model.data)},o.prototype.renderItem=function(e){return["<",this.collectionItemTagName," ",this.collectionItemIdAttName,"='",e.id+"'>","<span class='name'>",e,"</span></",this.collectionItemTagName,">"].join("")},o.prototype.mapDataToUI=function(e){var t,n,r,s;for(t in this.$elements)r=this.$elements[t],r.length&&this.$elements.hasOwnProperty(t)&&r[0].getAttribute("data-model-val")&&(n=e[t]||"",s=r[0].tagName,i.isArray(n.data)?this.mapCollectionToUI(t,n,r):s==="INPUT"||s==="TEXTAREA"||s==="HIDDEN"?r.val(n):r.text(n))},o.prototype.mapCollectionToUI=function(e,t,n){var r={container:n,model:t},i;this.compositeControllers[e]?this.compositeControllers[e].setModel(t):(i=n.data("ui-renderer"),i&&(r.renderItem=controller.renderer[i]),this.compositeControllers[e]=(new o(r)).init())},e.ModelAwareController=o}(controller,$),function(e){e.craftjs=e.craftjs||{},e.ALL_BUILD_FLAGS=["plain","mangle","expand","squeeze","beautify","minimize","lint"],e.LINT_OPTIONS={passfail:!1,maxerr:1e3,browser:!0,node:!1,rhino:!1,couch:!1,wsh:!1,jquery:!0,prototypejs:!1,mootools:!1,dojo:!1,debug:!1,devel:!0,es5:!0,strict:!1,globalstrict:!1,asi:!1,laxbreak:!0,bitwise:!0,boss:!1,curly:!0,eqeqeq:!0,eqnull:!1,evil:!1,expr:!1,forin:!1,immed:!0,latedef:!0,loopfunc:!1,noarg:!0,regexp:!0,regexdash:!1,scripturl:!0,shadow:!1,supernew:!1,undef:!0,newcap:!0,noempty:!0,nonew:!0,nomen:!0,onevar:!1,plusplus:!1,sub:!1,trailing:!0,white:!0,indent:4},e.LINT_DESC={passfail:"Stop on first error",maxerr:"Maximum error before stopping",browser:"Standard browser globals e.g. `window`, `document`",node:"Allow globals of node.js",rhino:"Allow globals of rhino",couch:"Allow globals of couch DB",wsh:"Allow globals of Windows Scripting Host",jquery:"allow jquery",prototypejs:"allow prototypejs",mootools:"allow mootools",dojo:"allow dojo",predef:"Custom globals",debug:"Allow debugger statements e.g. browser breakpoints",devel:"Allow developments statements e.g. `console.log();`",es5:"Allow ECMAScript 5 syntax",strict:"Require `use strict` pragma in every file",globalstrict:"Allow global 'use strict' (also enables 'strict')",asi:"Tolerate Automatic Semicolon Insertion (no semicolons)",laxbreak:"Tolerate unsafe line breaks e.g. `return [\n] x` without semicolons",bitwise:"Prohibit bitwise operators (&, |, ^, etc.)",boss:"Tolerate assignments inside if, for & while. Usually conditions & loops are for comparison, not assignments",curly:"Require {} for every new block or scope",eqeqeq:"Require triple equals i.e. `===`",eqnull:"Tolerate use of `== null`",evil:"Tolerate use of `eval`",expr:"Tolerate `ExpressionStatement` as Programs",forin:"Tolerate `for in` loops without `hasOwnPrototype`",immed:"Require immediate invocations to be wrapped in parens e.g. `( function (){}() );`",latedef:"Prohipit variable use before definition",loopfunc:"Allow functions to be defined within loops",noarg:"Prohibit use of `arguments.caller` and `arguments.callee`",regexp:"Prohibit `.` and `[^...]` in regular expressions",regexdash:"Tolerate unescaped last dash i.e. `[-...]`",scripturl:"Tolerate script-targeted URLs",shadow:"Allows re-define variables later in code e.g. `var x=1; x=2;`",supernew:"Tolerate `new function () { ... };` and `new Object;`",undef:"Require all non-global variables be declared before they are used",newcap:"Require capitalization of all constructor functions e.g. `new F()`",noempty:"Prohibit use of empty blocks",nonew:"Prohibit use of constructors for side-effects",nomen:"Prohibit use of initial or trailing underbars in names",onevar:"Allow only one `var` statement per function",plusplus:"Prohibit use of `++` & `--`",sub:"Tolerate all forms of subscript notation besides dot notation e.g. `dict['key']` instead of `dict.key`",trailing:"Prohibit trailing whitespaces",white:"Check against strict whitespace and indentation rules",indent:"Specify indentation spacing"}}(this),function(e,t){e.craftjs.services=e.craftjs.services||{},e.craftjs.services.storeJob=function(e,n){t.ajax("/jobs",{type:"PUT",data:JSON.stringify(e),dataType:"json",contentType:"application/json",success:function(e){n&&n(e)}})},e.craftjs.services.release=function(e,n){t.ajax("/release",{type:"POST",data:JSON.stringify(e),dataType:"json",contentType:"application/json",error:function(e){n?n(undefined,e):console.log(e)},success:function(e){n?n(e):(console.log("res",e),document.location="/"+craftjs.data.dist+"/"+e.path)}})},e.craftjs.services.deleteRelease=function(e,n){t.ajax("/project/build"+e,{type:"DELETE",dataType:"json",contentType:"application/json",success:function(e){n&&e.status==="OK"&&n()}})},e.craftjs.services.sendConfiguration=function(e,n){t.ajax("/config",{type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e),success:function(e){n&&e.status==="ok"&&n()}})},e.craftjs.services.addGitRepository=function(e,n,r){t.ajax("/config/githook",{type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({name:e,url:n}),success:function(e){r(e)}})},e.craftjs.services.addCdnResource=function(e,n,r){t.ajax("/config/cdn/name",{type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({name:e,url:n}),success:function(e){r(e)}})},e.craftjs.services.getAllTests=function(e){t.ajax("/test",{type:"GET",dataType:"json",contentType:"application/json",data:JSON.stringify({}),success:function(t){e(t)}})},e.craftjs.services.getAllJavascripts=function(e){t.ajax("/test/javascripts",{type:"GET",dataType:"json",contentType:"application/json",data:JSON.stringify({}),success:function(t){e(t)}})},e.craftjs.services.removeCdnResource=function(e,n){t.ajax("/config/cdn/"+e,{type:"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify({name:e}),success:function(e){n(e)}})},e.craftjs.services.gitPull=function(e,n){t.ajax("/config/githook/"+e,{type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify({name:e}),success:function(e){n(e)}})},e.craftjs.services.deleteGitRepository=function(e,n){t.ajax("/config/githook/"+e,{type:"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify({name:e}),success:function(e){n(e)}})},e.craftjs.services.deleteFile=function(e,n){t.ajax("/"+craftjs.data.context+"/"+e,{type:"DELETE",dataType:"json",contentType:"application/json",success:function(e){n&&e.status==="OK"&&n()}})},e.craftjs.services.phantomTest=function(e,n,r){t.ajax({url:e,contentType:"application/json",success:n,error:r})}}(this,jQuery);var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function a(e){return u.test(e)}function p(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return h[e]||e})}function d(e,t,n,r){r=r||"<template>";var i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),u=i.slice(s,o),a;for(var f=0,l=u.length;f<l;++f)a=f+s+1,u[f]=(a===n?" >> ":"    ")+u[f];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,u.join("\n"),"",e.message].join("\n"),e}function v(e,t,n){if(e===".")return t[t.length-1];var r=e.split("."),i=r.length-1,s=r[i],o,u,a=t.length,f,l;while(a){l=t.slice(0),u=t[--a],f=0;while(f<i){u=u[r[f++]];if(u==null)break;l.push(u)}if(u&&s in u){o=u[s];break}}return typeof o=="function"&&(o=o.call(l[l.length-1])),o==null?n:o}function m(e,t,n,r){var i="",u=v(e,t);if(r){if(u==null||u===!1||s(u)&&u.length===0)i+=n()}else if(s(u))o(u,function(e){t.push(e),i+=n(),t.pop()});else if(typeof u=="object")t.push(u),i+=n(),t.pop();else if(typeof u=="function"){var a=t[t.length-1],f=function(e){return S(e,a)};i+=u.call(a,n(),f)||""}else u&&(i+=n());return i}function g(t,n){n=n||{};var r=n.tags||e.tags,i=r[0],s=r[r.length-1],o=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],u=[],l=!1,c=!1,h=function(){if(l&&!c&&!n.space)while(u.length)o.splice(u.pop(),1);else u=[];l=!1,c=!1},p=[],v,m,g,y=function(e){r=f(e).split(/\s+/),m=r[0],g=r[r.length-1]},b=function(e){o.push('";',v,'\nvar partial = partials["'+f(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,r){var i=f(e);if(i==="")throw d(new Error("Section name may not be empty"),t,N,n.file);p.push({name:i,inverted:r}),o.push('";',v,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var r=f(e),i=p.length!=0&&p[p.length-1].name;if(!i||r!=i)throw d(new Error('Section named "'+r+'" was never opened'),t,N,n.file);var s=p.pop();o.push('";',"\n    return buffer;","\n  };","\n})();"),s.inverted?o.push("\nbuffer += renderSection(name,stack,callback,true);"):o.push("\nbuffer += renderSection(name,stack,callback);"),o.push('\nbuffer += "')},x=function(e){o.push('";',v,'\nbuffer += lookup("'+f(e)+'",stack,"");','\nbuffer += "')},T=function(e){o.push('";',v,'\nbuffer += escapeHTML(lookup("'+f(e)+'",stack,""));','\nbuffer += "')},N=1,C,k;for(var L=0,A=t.length;L<A;++L)if(t.slice(L,L+i.length)===i){L+=i.length,C=t.substr(L,1),v="\nline = "+N+";",m=i,g=s,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,s="="+s,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":s="}"+s;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}var O=t.indexOf(s,L);if(O===-1)throw d(new Error('Tag "'+i+'" was not closed properly'),t,N,n.file);var M=t.substring(L,O);k&&k(M);var _=0;while(~(_=M.indexOf("\n",_)))N++,_++;L=O+s.length-1,i=m,s=g}else{C=t.substr(L,1);switch(C){case'"':case"\\":c=!0,o.push("\\"+C);break;case"\r":break;case"\n":u.push(o.length),o.push("\\n"),h(),N++;break;default:a(C)?u.push(o.length):c=!0,o.push(C)}}if(p.length!=0)throw d(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,N,n.file);h(),o.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=o.join("").replace(/buffer \+= "";\n/g,"");return n.debug&&(typeof console!="undefined"&&console.log?console.log(D):typeof print=="function"&&print(D)),D}function y(e,t){var n="view,partials,stack,lookup,escapeHTML,renderSection,render",r=g(e,t),i=new Function(n,r);return function(n,r){r=r||{};var s=[n];try{return i(n,r,s,v,p,m,S)}catch(o){throw d(o.error,e,o.line,t.file)}}}function w(){b={}}function E(e,t){return t=t||{},t.cache!==!1?(b[e]||(b[e]=y(e,t)),b[e]):y(e,t)}function S(e,t,n){return E(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=g,e.compile=E,e.render=S,e.clearCache=w,e.to_html=function(e,t,n,r){var i=S(e,t,n);if(typeof r!="function")return i;r(i)};var t=Object.prototype.toString,n=Array.isArray,r=Array.prototype.forEach,i=String.prototype.trim,s;n?s=n:s=function(e){return t.call(e)==="[object Array]"};var o;r?o=function(e,t,n){return r.call(e,t,n)}:o=function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var u=/^\s*$/,f;if(i)f=function(e){return e==null?"":i.call(e)};else{var l,c;a("Ã‚ ")?(l=/^\s+/,c=/\s+$/):(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),f=function(e){return e==null?"":String(e).replace(l,"").replace(c,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},b={}})(Mustache),function(e){var t={};e.craftjs.render=function(e,t){return Mustache.render(e,t)},e.craftjs.renderById=function(e,n){return t[e]||(t[e]=$("#"+e).text()),Mustache.render(t[e],n)}}(typeof global=="undefined"?this:global),function(e,t){var n=function(n,r){return new controller.ModelAwareController({path:craftjs.data.path,model:n,elementSelectors:{buttons:".bag-button",projectLabel:".project-name",runAllTestsButton:".all-tests"},events:{"@nav":function(e){var n=t(e.target),r=n.data("path");r&&(document.location=r)},"@toggle-file-to-job":function(){var e={};e[craftjs.data.path]={},this.model.data[craftjs.data.path]?this.model.delete(e):this.model.set(e)},"@delete-file":function(e){var n=t(e.target),r=n.data("path");r&&craftjs.services.deleteFile(r,function(){n.closest("li").remove()})},"@toggle-source-markers":function(){var e=/^[ \d]*:.*\/\/.*(FIXME|TODO)/,n=[],r=t("#markers");r.empty(),t(".source pre").each(function(){var r=t(this),i=r.text(),s,o;i.match(e)&&(r.toggleClass("marker"),r.hasClass("marker")&&(s=i.replace(/\/\//,""),o=s.indexOf("FIXME")>-1,s=s.replace(/FIXME/,""),s=s.replace(/TODO/,""),n.push("<li><a href='#"+r.data("id")+"' class='"+(o?"fixme":"todo")+"'>"+(o?"FIXME":"TODO")+"</a> line "+s+"</li>")))}),n.length<1?t(".marker-button").text("no TODOs/FIXMEs found"):t(".marker-button").remove(),r.html(n.join(""))},"@build":function(e){var n=t(e.target),i=n.data("path"),s=r(ALL_BUILD_FLAGS,n.closest("li"));document.location="/"+craftjs.data.context+"/"+i+s},"@build-job":function(e){var n=t(e.target),i=n.data("path"),s=r(ALL_BUILD_FLAGS,n.closest("li"));craftjs.services.release({jobfile:i},function(e,t){t?alert("error"+JSON.stringify(t)):document.location="/"+craftjs.data.dist+"/"+e.path})},"@send-configuration":function(e){var n=t("#resource-path"),r=n.val(),i=t("#use-git").attr("checked")==="checked",s=" while not using GIT";r.trim().length<1?t("#configuration .feedback").text("enter a path to the directory where your javascripts are").show():craftjs.services.sendConfiguration({path:r,useGit:i},function(){n.attr("disabled","true"),i&&(s=" while using GIT"),t("#configuration .feedback").text("resource directory points now to '"+r+"'"+s).show()})},"@remove-from-project":function(e){var n=t(e.target),r=n.data("path"),i={};i[r]={},this.model.delete(i)},"@edit-project-name":function(e){var t=prompt("Project name",localStorage.projectName);t&&(localStorage.projectName=t,this.render()),e.stopPropagation()},"@show-test-report":function(e){var n=t(e.target);n.next().toggle()},"@show-job-dialog":function(){var e=this;this.jobDialogController||(this.jobDialogController=new craftjs.JobDialogController({containerSelector:"#job-dialog"}),this.jobDialogController.init()),this.jobDialogController.show()},"@test-phantom-all":function(e){t("[data-action='test-phantom']").trigger("click")},"@test-phantom":function(e){var n=t(e.target).closest("a"),r=n.attr("href"),i=n.parent().find(".status-label");n.parent().find(".qunit-report").remove(),t(".qunit-report").hide(),i.length<1?(i=t("<span data-action='show-test-report' class='status-label label label-warning'>Phantom test running...</span>"),i.insertBefore(n)):i.text("phantomjs test running...").removeClass("label-important").removeClass("label-success").addClass("label-warning"),craftjs.services.phantomTest(r,function(e){console.log(e);var n=t("#phantom-test-report").text();content=Mustache.render(n,e),e.failed>0?i.text("phantomjs test failed").removeClass("label-warning").addClass("label-important"):i.text("phantomjs test succeeded").removeClass("label-warning").addClass("label-success"),t(content).insertAfter(i)},function(t){alert("phantom testing of "+r+" failed: "+e.message)}),e.stopPropagation()},"click .collapser":function(e){var n=t(e.target),r,i=n.data("dependent"),s=n.data("slide");i?r=t(i):n.hasClass("collapser")&&(r=n.next()),r&&s?r.slideToggle():r&&r.toggle()}},render:function(){var e=this;this.$elements.projectLabel.text(localStorage.projectName),this.model.data[this.path]?this.$elements.buttons.addClass("contained").text("remove from Favorites"):this.$elements.buttons.removeClass("contained").text("add to Favorites"),t("[data-action='test-phantom']").each(function(){return e.$elements.runAllTestsButton.show(),!1})}})};e.craftjs.PageController=n}(this,jQuery),function(e,t){var n=function(e,t){var n={},r=prompt("Name of this release");if(r){if(/[\s]/.test(r)){alert("no spaces or tabs allowed");return}n[e]={},craftjs.services.release({name:r,expand:!0,files:n,transformation:t})}},r=function(r,i,s){var o=["mangle","expand","squeeze","minimize","beautify"];return new controller.ModelAwareController({containerSelector:r,scann:!0,model:i,elementSelectors:{plain:"#plain",mangle:"#mangle",expand:"#expand",squeeze:"#squeeze",beautify:"#beautify",minimize:"#minimize",lint:"#lint",release:"#release"},events:{"@build":function(e){var r=t(e.target),i=r.data("path"),o=s(ALL_BUILD_FLAGS,this.container);this.$elements.release.attr("checked")?n(craftjs.data.path,this.getTransformationFlags()):i&&(document.location="/"+craftjs.data.context+"/"+i+o)}},getTransformationFlags:function(){var e={},n=this;return t.each(o,function(){n.$elements[this]&&n.$elements[this].attr("checked")?e[this]=!0:e[this]=!1}),e}})};e.craftjs.ToolbarController=r}(this,jQuery),function(e){var t={info:function(e,t,n,r){$("#"+e+"-alert").html(craftjs.renderById("alert-template",{type:r||"info",label:n||"Info",message:t}))},error:function(e,n,r){t.info(e,n,r||"Error","error")},success:function(e,n,r){t.info(e,n,r||"Success","success")},chomp:function(e){return e.replace(/ /g,"")}};e.craftjs=e.craftjs||{},e.craftjs.feedback=t}(this),function(e){var t=function(e,t){$("#git-alert").html(craftjs.renderById("git-pull-template",{type:"success",label:"Success fully pulled repository "+t,message:e}))},n=function(e){return e.replace(/ /g,"")},r=function(e,r){return new controller.ModelAwareController({containerSelector:"#"+r,model:e,events:{"@add-repo":function(){var e=this;e.repoDialog||(this.repoDialog=$("#repo-dialog").modal({show:!1}),e.repoDialog.on("show",function(){e.repoDialog.find(".error").hide()}),e.repoDialog.find(".btn-primary").on("click",function(){var t=n(e.repoDialog.find("#repo-name").val()),r=n(e.repoDialog.find("#repo-url").val());craftjs.feedback.info("git","started cloning repository <code>"+r+"</code> to <code>"+t+"</code>"),e.repoDialog.modal("hide"),craftjs.services.addGitRepository(t,r,function(e){if(e.status==="ok"){var n="<li class='row-fluid' data-name='"+t+"'><span class='span2'><span class='label label-warning' "+"onclick='document.location=\"/repo/"+t+"\"'>repo:/"+t+"</span></span><a class='btn btn-primary btn-mini' "+"data-action='git-pull'>"+"pull</a><span class='url'>"+r+"</span><button class='close' data-action='remove-git-repo'>"+"&times;</button></li>";$("#git-hooks").append(n),craftjs.feedback.success("git","Cloned repository '"+r+"' to '"+t+"'")}else craftjs.feedback.error("git","failed cloning repository <code>"+r+"</code> to <code>"+t+"</code>: "+e.message)})})),e.repoDialog.modal("show")},"@remove-git-repo":function(e){var t=$(e.target).closest("li"),r=n(t.data("name"));r&&craftjs.services.deleteGitRepository(r,function(e){e.status!=="ok"?craftjs.feedback.error("git","while removing repository '"+e.message+"'"):(t.remove(),craftjs.feedback.success("git","removed repository <code>"+r+"</code>"))})},"@git-pull":function(e){var n=$(e.target).closest("li"),r=n.data("name");r&&(craftjs.feedback.info("git","started pulling repository '"+r+"'"),craftjs.services.gitPull(r,function(e){console.log(JSON.stringify(e)),e.status!=="ok"?craftjs.feedback.info("git","while pulling repository <code>"+r+"</code>: "+e.message):t(e.output,r)}))}}})};e.craftjs.GitConfigController=r}(this),function(e){var t=function(e,t){return new controller.ModelAwareController({containerSelector:"#"+t,model:e,events:{"@open-cdn-dialog":function(){var e=this;this.cdnDialog||(this.cdnDialog=$("#cdn-dialog").modal({show:!1}),this.cdnDialog.on("show",function(){e.cdnDialog.find(".error").hide()}),this.cdnDialog.find(".btn-primary").on("click",function(){var t=e.cdnDialog.find("#lib-name").val(),n=e.cdnDialog.find("#lib-url").val();e.cdnDialog.modal("hide"),craftjs.feedback.info("cdn","start downloading <code>"+n+"</code> to <code>"+t+"</code>"),craftjs.services.addCdnResource(t,n,function(e){console.log("dta",e),e.status!=="ok"?craftjs.feedback.error("cdn","while downloading '"+n+"':"+e.message):($("#cdn-libs").append(craftjs.renderById("cdn-item-template",{name:t,url:n})),craftjs.feedback.success("cdn","Downloaded <code>"+n+"</code> to <code>"+t+"</code> successfully"))})})),this.cdnDialog.modal("show")},"@remove-cdn-lib":function(e){var t=$(e.target).closest("li"),n=t.data("name");craftjs.services.removeCdnResource(n,function(e){e.status!=="ok"?craftjs.feedback.error("cdn","while removing cdn resource <code>"+n+"</code>:"+e.message):(t.remove(),craftjs.feedback.success("cdn","Removed CDN resource <code>"+n+"</code> successfully"))})}}})};e.craftjs.CdnConfigController=t}(this),function(e,t){var n=function(e){return t.map(e,function(e,t){var n;return typeof e=="boolean"&&(n={key:t,val:e,desc:LINT_DESC[t],on:e===!0?"on":"off",type:typeof e}),n})},r=function(e,t){return craftjs.renderById("lint-options-tmpl",{options:n(e),maxerr:e.maxerr,indent:e.indent,title:t})},i=function(n,i){return new controller.ModelAwareController({model:i,containerSelector:n,events:{"click label":function(e){var n=t(e.target),r=n.data("name"),i={};i[r]=!this.model.data[r],this.model.set(i)},"@edit-maxerr":function(){var e=prompt("max number of errors",this.model.get("maxerr"));e&&this.model.set({maxerr:e})},"@edit-indent":function(){var e=prompt("number of spaces",this.model.get("indent"));e&&this.model.set({indent:e})}},render:function(){var e=[];e.push(r(this.model.data,"JSHint options")),this.container.html(e.join(""))},toQueryString:function(){var e="";return t.each(this.model.data,function(t,n){e+="lint-"+t+"="+n+"&"}),e}})};e.craftjs.LintController=i}(this,jQuery),function(e,t){var n=function(e){return craftjs.render("<label><span class='label label-info'>{{name}}<input type='checkbox' name='{{name}}'/></span></label>",{name:e})},r=function(e){return craftjs.renderById("project-file",{path:e})},i=function(i,s){return new controller.ModelAwareController({model:s,containerSelector:i,events:{"@build-project":function(){this.isEmpty()||(console.log("this.getTransformFlags()",this.getTransformFlags()),craftjs.services.release({name:localStorage.projectName,files:this.model.data,expand:!0,transformation:this.getTransformFlags()}))},"@save-job":function(){var e=prompt("Enter a job name");e&&!this.isEmpty()&&craftjs.services.storeJob({name:e,files:this.model.data,expand:!0,transformation:this.getTransformFlags()},function(e){document.location="/"+craftjs.data.jobs+"/"+e.data.path})}},render:function(){var e=["<div class='build-flags'>"];e.push(t.map(["mangle","squeeze","minimize","beautify"],n).join("")),e.push("<button class='btn btn-inverse btn-mini build' data-action='build-project'"),this.isEmpty()&&e.push(" disabled='disabled'"),e.push(">build</button><button data-action='save-job' class='btn btn-inverse btn-mini build'>save</button></div><ul>"),t.each(this.model.data,function(t){e.push(r(t))}),e.push("</ul>"),this.container.html(e.join(""))},isEmpty:function(){var e;for(e in this.model.data)if(this.model.data.hasOwnProperty(e))return!1;return!0},getTransformFlags:function(){var e={},n=this;return t.each(["mangle","squeeze","beautify","minimize"],function(){console.log(this,n.container.find("[name='"+this+"']").attr("checked")),n.container.find("[name='"+this+"']").attr("checked")?e[this]=!0:e[this]=!1}),e}})};e.craftjs.FavoritesPanelController=i}(this,jQuery),function(e,t){var n=function(e,n,r){var i=t("#"+e),s="block",o="none",u=t("#"+n),a=t("#"+r),f=u.find(".line"),l=f.map(function(){return this.style}),c=f.map(function(){return t(this).text().replace(/^\d*:\t/,"")}),h=function(){t.each(l,function(e){l[e].display="block"})},p=function(e,t){e<1?(a.html("no matches found for <code>/"+t+"/</code>"),h()):a.html(e+" matches found for <code>/"+t+"/</code>")};f=undefined,i.bind("change",function(){var e=0,t=i.val(),n;try{n=new RegExp(t,"ig"),t?(c.each(function(t){this.match(n)?(l[t].display=s,e+=1):l[t].display=o}),p(e,t)):(a.text("grep source code =>"),h())}catch(r){alert("RegExp error: '"+r.message+"'")}})};e.craftjs.SearchController=n}(this,jQuery),function(e){var t=function(e){e.events=$.extend({"@next":function(){this.next()},"@previous":function(){this.previous()},"@save":function(){this.save()}},e.events||{}),e.model=new model.Model({data:{steps:["cron","tests","build","save"],currentStep:0}}),controller.ModelAwareController.call(this,e)};t.prototype=new controller.ModelAwareController,t.prototype.init=function(){var e=this;controller.ModelAwareController.prototype.init.call(this),this.loadTests(),this.loadJavascripts(),this.testFilter=this.initFilter($("#test-filter"),".test-list li","name"),this.javascriptFilter=this.initFilter($("#javascript-filter"),".javascript-list li","name"),this.container.modal({show:!1}),this.container.on("show",function(){e.container.find(".error").hide()})},t.prototype.initFilter=function(e,t,n){return e.bind("keyup",function(r){var i=e.val();$(t).each(function(){var e=$(this),t=new RegExp(i,"g");e.data(n).match(t)?e.show():e.hide()})})},t.prototype.render=function(){var e=this,t=this.model.get("steps")[this.model.get("currentStep")];$.each(this.model.get("steps"),function(){e.container.find("."+this).hide()}),this.beforeTransition[t]&&this.beforeTransition[t].call(this),$("."+t).show()},t.prototype.renderSummary=function(){var e={tests:[],javascripts:[],name:$("#job-name").val(),notification:$("#job-notification").val(),cronType:this.container.find("input[name='cron-type']:checked").val(),expand:!0,transformation:{mangle:this.container.find("#mangle").attr("checked")==="checked",squeeze:this.container.find("#squeeze").attr("checked")==="checked",minimize:this.container.find("input[name='output']:checked").val()==="minimize",beautify:this.container.find("input[name='output']:checked").val()==="beautify"}};this.container.find(".test-list li input").each(function(){var t=$(this);t.attr("checked")==="checked"&&e.tests.push(t.val())}),this.container.find(".javascript-list li input").each(function(){var t=$(this);t.attr("checked")==="checked"&&e.javascripts.push(t.val())}),this.summaryData=e,$("#save-panel").html(craftjs.renderById("summary-template",e))},t.prototype.save=function(){craftjs.services.storeJob(this.summaryData,function(e){console.log(e)}),this.container.modal("hide")},t.prototype.loadTests=function(){this.loadFileData("getAllTests",".test-list","test-list-item")},t.prototype.loadJavascripts=function(){this.loadFileData("getAllJavascripts",".javascript-list","javascript-list-item")},t.prototype.loadFileData=function(e,t,n){var r=this;craftjs.services[e](function(e){r.container.find(t).html(craftjs.renderById(n,{tests:e.files}))})},t.prototype.show=function(){this.container.modal("show")},t.prototype.hide=function(){this.container.modal("hide")},t.prototype.next=function(){var e=this.model.get("currentStep"),t=this.model.get("steps").length,n=this.model.get("steps")[e],r;e<t-1&&(this.container.find(".error").hide(),this.validators[n]?(r=this.validators[n].call(this),r.length<1?(e++,this.model.set({currentStep:e})):this.showValidationErrors(r)):(e++,this.model.set({currentStep:e})))},t.prototype.showValidationErrors=function(e){$.each(e,function(){$("#"+this.fieldName+"-error").text(this.message).show()})},t.prototype.previous=function(){var e=this.model.get("currentStep");e>0&&(e--,this.model.set({currentStep:e}))},t.prototype.beforeTransition={save:function(){this.renderSummary()}},t.prototype.validators={cron:function(){var e=[],t=this.container.find("#job-name").val(),n=this.container.find("#job-notification").val(),r=this.container.find("input[name='cron-type']:checked").val(),i=this.container.find("input[name='output']:checked").val();return t.length<1&&e.push({fieldName:"job-name",message:"a job ust have a name"}),r||e.push({fieldName:"cron-type",message:"choose an automation frequency"}),i||e.push({fieldName:"ast-flags",message:"choose an output type (minimize or pretty-print)"}),n&&n.indexOf("@")<1&&e.push({fieldName:"job-notification",message:"invalid email address"}),e}},e.craftjs.JobDialogController=t}(this),$(function(){var e,t,n,r,i,s,o,u,a,f=function(){var t;return e||(t=localStorage.bag,e=t?JSON.parse(t):{}),e},l=function(){localStorage.bag=JSON.stringify(e)},c=function(){var e;return n||(e=localStorage.lintOptions,n=e?JSON.parse(e):LINT_OPTIONS),n},h=function(){localStorage.lintOptions=JSON.stringify(r.data)},p=function(e,t){var n="?";return $.each(e,function(){t.find("[name='"+this+"']").attr("checked")&&(n+=this+"=true&")}),t.find("[name='lint']").attr("checked")&&(n+=u.toQueryString()),n},d=function(){typeof modules!="undefined"&&$.each(modules,function(){this()})};localStorage.projectName||(localStorage.projectName="default"),t=(new model.Model({data:f()})).bind("change",l).bind("remove",l),r=(new model.Model({data:c()})).bind("change",h),u=(new craftjs.LintController("#lint-options",r)).init(),s=(new craftjs.ToolbarController("#build-toolbar",new model.Model({data:{expand:!1,mangel:!1,squeeze:!1,minimize:!1,beautify:!1,lint:!0,plain:!1,release:!1}}),p)).init(),o=(new craftjs.FavoritesPanelController("#project-files",t)).init(),i=(new craftjs.PageController(t,p)).init(),a=new craftjs.SearchController("search-script","source","result-info"),d()})